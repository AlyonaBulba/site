{% extends 'base.html' %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}
{% block content %}

<style>
  .profile-container {
    max-width: 600px;
    margin: 80px auto;
    padding: 40px;
    background: white;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    border-radius: 16px;
    text-align: center;
    font-family: 'Segoe UI', sans-serif;
  }

  .profile-container h2 {
    font-size: 32px;
    margin-bottom: 20px;
    color: #333;
  }

  .profile-container p {
    font-size: 18px;
    color: #666;
    margin-bottom: 15px;
  }

  .logout-button, .change-password-button {
    background: #4e54c8;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background 0.3s ease;
    margin: 10px;
  }

  .logout-button:hover {
    background: #d32f2f;
  }

  .change-password-button:hover {
    background: #5c63e0;
  }
</style>

<div class="profile-container">
  <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
  <p>–ü–æ—á—Ç–∞: <strong>{{ email }}</strong></p>

  {% if address_str %}
    <p>–ê–¥—Ä–µ—Å: <strong>{{ address_str }}</strong></p>
  {% endif %}


  <a class="change-password-button" href="/forgot_password">üîë –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</a>
  <a class="logout-button" href="/logout">üîì –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</a>

  <button class="change-password-button" onclick="document.getElementById('addressMap').style.display='block'">üìç –ú–æ–π –∞–¥—Ä–µ—Å</button>

  <div id="addressMap" style="display:none; margin-top: 20px;">
    <div id="map" style="height: 300px; width: 100%; margin-bottom: 15px;"></div>
    <form method="POST" action="/save_address">
      <input type="hidden" name="lat" id="lat">
      <input type="hidden" name="lng" id="lng">
      <button type="submit" class="change-password-button">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å</button>
    </form>
  </div>
</div>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  let map;
  let marker;

  function initLeafletMap() {
    if (!navigator.geolocation) {
      alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
      return;
    }

    navigator.geolocation.getCurrentPosition(function(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      map = L.map('map').setView([lat, lng], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      marker = L.marker([lat, lng], { draggable: true }).addTo(map);

      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;

      marker.on('dragend', function(e) {
        let coords = marker.getLatLng();
        document.getElementById('lat').value = coords.lat;
        document.getElementById('lng').value = coords.lng;
      });
    }, function() {
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ");
    });
  }

  document.querySelector('button[onclick]').addEventListener('click', initLeafletMap);
</script>

{% endblock %}
